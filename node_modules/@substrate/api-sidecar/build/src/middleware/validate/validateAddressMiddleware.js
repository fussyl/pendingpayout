"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.validateAddressMiddleware = void 0;
const checkChecksum_1 = require("@polkadot/util-crypto/address/checkChecksum");
const defaults_1 = require("@polkadot/util-crypto/address/defaults");
const decode_1 = require("@polkadot/util-crypto/base58/decode");
const http_errors_1 = require("http-errors");
/**
 * Express Middleware to validate that an `:address` param is properly formatted.
 */
exports.validateAddressMiddleware = (req, _res, next) => {
    if (!('address' in req.params)) {
        return next();
    }
    const [isValid, error] = checkAddress(req.params.address);
    if (!isValid && error) {
        return next(new http_errors_1.BadRequest(error));
    }
    return next();
};
/**
 * Verify that an address is a valid substrate ss58 address.
 *
 * Note: this is very similar '@polkadot/util-crypto/address/checkAddress,
 * except it does not check the prefix.
 *
 * @param address potential ss58 address
 */
function checkAddress(address) {
    let decoded;
    try {
        decoded = decode_1.default(address);
    }
    catch (error) {
        return [false, error.message];
    }
    if (!defaults_1.default.allowedEncodedLengths.includes(decoded.length)) {
        return [false, 'Invalid decoded address length'];
    }
    const [isValid] = checkChecksum_1.default(decoded);
    return [isValid, isValid ? undefined : 'Invalid decoded address checksum'];
}
//# sourceMappingURL=validateAddressMiddleware.js.map